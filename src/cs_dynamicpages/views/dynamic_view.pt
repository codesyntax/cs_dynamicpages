<html xmlns="http://www.w3.org/1999/xhtml" xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xmlns:metal="http://xml.zope.org/namespaces/metal" xmlns:tal="http://xml.zope.org/namespaces/tal"
  metal:use-macro="context/main_template/macros/master" i18n:domain="cs_dynamicpages"
  tal:define="portal_url context/portal_url;" data-portal-url="${portal_url}">

<body>
  <metal:main fill-slot="main">
    <main id="content">
      <div class="fixed-top d-flex justify-content-end py-2 me-2" tal:condition="view/can_edit">
        <div
          class="d-inline-flex mb-3 px-3 py-2 fw-semibold text-warning-emphasis bg-warning-subtle border border-warning-subtle rounded-5">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" role="switch" id="editModeToggle" checked>
            <label class="form-check-label" for="editModeToggle">Edit Mode</label>
          </div>
        </div>
      </div>
      <tal:features define="
                        rows view/rows;
                      ">
        <tal:featured repeat="brain rows">
          <section tal:define="row brain/getObject;" class="dynamic-row ${row/row_template} state-${row/review_state}"
            data-elementid="${row/id}" data-elementurl="${row/absolute_url}"
            data-parenturl="${row/aq_parent/absolute_url}" data-delete-target="true" data-move-target="true">
            <div class="edit-options edit-buttons d-flex gap-2" tal:condition="row/can_edit">
              <small
                class="d-inline-flex mb-3 px-2 py-1 fw-semibold text-warning-emphasis bg-warning-subtle border border-warning-subtle rounded-2 position-relative">
                Template: ${row/row_template}
              </small>
              <!-- <a class="btn btn-outline-primary btn-sm align-self-start" href="${row/absolute_url}">View</a> -->
              <a class="btn btn-outline-primary btn-sm align-self-start" href="${row/absolute_url}/edit">Edit</a>
              <a class="btn btn-sm btn-danger align-self-start btn-delete-element" href="#" data-bs-toggle="modal"
                data-bs-target="#deleteElementModal" data-rowid="${row/id}">Delete row</a>

              <div class="ms-auto d-flex gap-2 align-items-start">

                <a tal:condition="python:not(repeat['brain'].start)"
                  class="btn btn-outline-primary btn-sm align-self-start" href="#" data-action="move-up">Move up</a>
                <a tal:condition="python:not(repeat['brain'].end)"
                  class="btn btn-outline-primary btn-sm align-self-start" href="#" data-action="move-down">Move
                  down</a>
                <div class="btn-group">
                  <a tal:attributes="class python:row.review_state() == 'published' and
                    'position-relative btn btn-outline-success btn-sm bg-success-subtle dropdown-toggle' or
                    'position-relative btn btn-outline-danger btn-sm bg-danger-subtle dropdown-toggle'" type="button"
                    class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" data-bs-display="static"
                    aria-expanded="false">
                    Review state: ${row/review_state}
                    <span
                      tal:attributes="class python:row.review_state() == 'published' and 'position-absolute top-0 start-100 translate-middle p-2 bg-success border border-light rounded-circle' or 'position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle'">
                    </span>
                  </a>
                  <ul class="dropdown-menu"
                    tal:define="transitions python:context.portal_workflow.getTransitionsFor(row)">
                    <tal:transitions repeat="transition transitions">
                      <li><a class="dropdown-item"
                          href="${transition/url}&_authenticator=${context/@@authenticator/token}">${transition/name}</a>
                      </li>
                    </tal:transitions>
                  </ul>
                </div>
              </div>

            </div>
            <tal:condition tal:condition="row/can_edit">
              <div class="edit-options features-list d-flex gap-2 align-items-start mb-3"
                tal:define="features_list row/featured_list" tal:condition="features_list">
                <tal:featured repeat="featured_brain features_list">
                  <div tal:define="featured_obj featured_brain/getObject;">
                    <div class="btn-group" data-elementid="${featured_obj/id}" data-parenturl="${row/absolute_url}"
                      data-elementurl="${featured_obj/absolute_url}" data-delete-target="true" data-move-target="true">
                      <a tal:attributes="class python:featured_obj.review_state() == 'published' and
                                          'position-relative btn btn-outline-success btn-sm bg-success-subtle dropdown-toggle' or
                                          'position-relative btn btn-outline-danger btn-sm bg-danger-subtle dropdown-toggle'"
                        type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown"
                        data-bs-display="static" aria-expanded="false">
                        ${featured_obj/Title}
                        <span
                          tal:attributes="class python:featured_obj.review_state() == 'published' and 'text-white position-absolute top-0 start-100 translate-middle p-1 bg-success border border-light rounded-circle' or 'text-white position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle'">
                        </span>
                      </a>
                      <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="${featured_obj/absolute_url}/edit">Edit</a>
                        </li>
                        <li>
                          <h5 class="dropdown-header">State</h5>
                        </li>
                        <tal:define
                          tal:define="featured_transitions python:context.portal_workflow.getTransitionsFor(featured_obj)">
                          <tal:featured_transitions repeat="featured_transition featured_transitions">
                            <li><a class="dropdown-item"
                                href="${featured_transition/url}&_authenticator=${context/@@authenticator/token}">${featured_transition/name}</a>
                            </li>
                          </tal:featured_transitions>
                        </tal:define>
                        <li>
                          <h5 class="dropdown-header">Move actions</h5>
                        </li>
                        <li><a class="dropdown-item" href="#" data-action="move-up"
                            tal:condition="python:not(repeat['featured_brain'].start)">Move up</a></li>
                        <li><a class="dropdown-item" href="#" data-action="move-down"
                            tal:condition="python:not(repeat['featured_brain'].end)">Move down</a></li>
                        <li>
                          <hr class="dropdown-divider">
                        </li>
                        <li><a class="ms-3 btn btn-sm btn-danger align-self-start btn-delete-element" href="#"
                            data-bs-toggle="modal" data-bs-target="#deleteElementModal">Delete</a></li>
                      </ul>
                    </div>
                  </div>
                </tal:featured>
                <tal:featured_add_button tal:condition="python:row.show_featured_add_button(request)">
                  <a class="btn btn-outline-primary btn-sm align-self-start"
                    href="${row/absolute_url}/++add++DynamicPageRowFeatured">Add new featured</a>
                </tal:featured_add_button>
              </div>
            </tal:condition>
            <div class="content">
              <replace tal:replace="structure python:row.render(request)"></replace>
            </div>
          </section>
        </tal:featured>
      </tal:features>
      <tal:condition tal:condition="view/can_edit">
        <div class="edit-options dynamic-row d-flex justify-content-center align-items-center"
          tal:condition="view/dynamic_page_folder_element_url">
          <a class="btn btn-primary btn-lg" href="${view/dynamic_page_folder_element_url}/++add++DynamicPageRow">Add
            new row</a>
        </div>
      </tal:condition>
      <!-- Delete Confirmation Modal -->
      <div class="modal fade" id="deleteElementModal" tabindex="-1" aria-labelledby="deleteElementModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="deleteElementModalLabel" i18n:translate="">Confirm Deletion</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <p i18n:translate="">Are you sure you want to delete this item? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" i18n:translate="">Cancel</button>
              <button type="button" class="btn btn-danger" id="confirmDeleteElement" i18n:translate="">Delete</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </metal:main>
</body>

</html>